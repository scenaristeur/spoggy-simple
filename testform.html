<html>
<style>
input{
  width: 100%;
}

</style>
<script src="./js/import-export.js"></script>
<body>
  Transform shapes (<a href="https://forum.solidproject.org/t/blog-post-shaping-linked-data-apps/1914/11" taget="blank">shex to forms</a>)
  <form>
    <select id="mySelect">
      <!--<option>https://holacratie.solid.community/public/Schema/circle.shex</option>-->
      <option>https://holacratie.solid.community/public/Schema/issue.shex</option>
      <option>https://holacratie.solid.community/public/Schema/role.shex</option>
      <option>https://holacratie.solid.community/public/Schema/tension.shex</option>
      <option>https://jmartin.inrupt.net/public/shapes/book.shex</option>
      <option>https://jmartin.inrupt.net/public/shapes/movie.shex</option>
      <option>https://jmartin.inrupt.net/public/shapes/data-browser.shex</option>
      <option>https://jmartin.inrupt.net/public/shapes/employee.shex</option>
    </select>

  </form>


  <input id="newShape"  placeholder="https://mypod.provider/public/shapes/shape.shex"></input>
  <button onclick="add()"> add yours / ajoutez votre shape to the select (shex)</button>
  (<a href="http://shexspec.github.io/primer/">http://shexspec.github.io/primer/</a>)
  <br><br>
  <button onclick="charge()">Charger / Load</button><br>
  <br>
  <!--  <div id="forms">

</div>-->

<fieldset id="formulaire">
  <legend id="legend"></legend>
  <ul id="formlist">
    <li>Click on Load button to load a shape/form </li>
    <li>Click sur le bouton "charger" pour charger un shape/form </li>
  </ul>

</fieldset>


</body>


<script>

function add(){
  var select = document.getElementById("mySelect")
  var option = document.createElement("option");
  option.text = document.getElementById("newShape").value.trim();
  select.add(option);
}

function charge(){
  var id = document.getElementById("mySelect").options.selectedIndex;
  var shapeUrl = document.getElementById("mySelect").options[id].text;
  var params = {}
  console.log(shapeUrl)
  params.source = shapeUrl
  var destination = {}
  destination.headId = "legend"
  destination.listeId = "formlist"
  params.destination = destination;
  fetchShex(params,updateFormsTest);
}

function updateFormsTest(data){
  console.log("#################\nUPDATEFORMS TEST",data)
  start = data.start;
  destination = data.params.destination;
  document.getElementById(destination.headId).innerHTML = start
  forms = new Map();
  data.shapes.forEach(function(s){
    f = new Map();
    name = s.name;
    console.log(s.constraints)
    f.set(name, s.constraints)
    forms.set(name,f)

  })
  console.log(forms)
  createFormLines(forms,start,destination.listeId)
}

function createFormLines(forms, start,dest){
  console.log(forms, start, dest)
  var liste = document.getElementById(dest)
  liste.innerHTML = "";
  var current = forms.get(start)
  console.log("current",current)
  var it=current.entries();
  var constr = it.next().value[1]
  console.log("val", constr)
  constr.forEach(function(c){
    var numberOf = c.numberOf
    var elems = c.elems;
    console.log(c)
    var br = document.createElement("br");
    var li = document.createElement("li");
    li.appendChild(document.createTextNode(elems[0]));
    //  li.appendChild( document.createTextNode( '\u00A0' ) ); // ajout espace
    li.appendChild(br.cloneNode())

    switch(elems[1]) {
      case "xsd:dateTime":
      case "xsd:date":
      // code block
      var datepicker = document.createElement("input")
      datepicker.setAttribute("type", "date")

      li.appendChild(datepicker);
      break;
      case "xsd:string":
      var basicInput = document.createElement("input")
      basicInput.setAttribute("placeholder", "xsd:string")
      li.appendChild(basicInput);
      break;
      case "IRI":
      var iriInput = document.createElement("input")
      iriInput.setAttribute("placeholder", "IRI")
      li.appendChild(iriInput);
      break;
      default:
      li.appendChild(document.createTextNode(elems[1]));
    }
    li.appendChild(br.cloneNode())
    //  li.appendChild( document.createTextNode( '\u00A0' ) );
    li.appendChild(document.createTextNode("nombre:"+numberOf));
    if (numberOf =="*"){
      li.appendChild(br.cloneNode())
      var addBtn = document.createElement("button");
      addBtn.innerHTML = "add one / ajouter un "+elems[1]
      li.appendChild(addBtn);

    }

    liste.appendChild(li);
    li.appendChild(br.cloneNode())





    li.appendChild(br.cloneNode())
  })
  var  submitBtn =document.createElement("button");
  submitBtn.innerHTML = "submit"
  liste.appendChild(submitBtn);
  /* creer tous les formulaires et les passer en display=none ?
  forms.forEach(function (f){
  console.log(f)
})*/

}


</script>


</html>
